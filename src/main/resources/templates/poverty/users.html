<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Bootstrap 101 Template</title>
    <!-- Bootstrap -->
    <link th:href="@{../static/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{../static/css/style.css}" rel="stylesheet">
</head>
<body>
<div class="container">
    <div class="col-sm-12">
        <h3>扶贫先建后补</h3>
        <!--分割线-->
        <div class="decoration"></div>
        <div class="full-width">
            <h4 class="shadow">补充你的基本信息</h4>
            <p class="shadow">在提交申请表之前，请检查你的信息是否完整，不可有错误信息！</p>
        </div>
        <!--分割线-->
        <div class="decoration"></div>
        <!--表单-->
        <div class="form">
            <form class="form-horizontal">
                <div class="form-group">
                    <label for="name" class="col-sm-2 control-label">姓名：</label>
                    <div class="col-sm-10">
                        <input type="text" name="name" class="form-control" id="name" placeholder="姓名">
                    </div>
                </div>
                <div class="form-group">
                    <label for="identity" class="col-sm-2 control-label">身份证号码：</label>
                    <div class="col-sm-10">
                        <input type="text" name="identity" class="form-control" id="identity" placeholder="身份证号码">
                    </div>
                </div>
                <div class="form-group">
                    <label for="tel" class="col-sm-2 control-label">联系电话：</label>
                    <div class="col-sm-10">
                        <input type="tel" name="tel" class="form-control" id="tel" placeholder="联系电话">
                    </div>
                </div>
                <div class="form-group">
                    <label for="village" class="col-sm-2 control-label">村组：</label>
                    <div class="col-sm-10">
                        <input type="text" name="village" class="form-control" id="village" placeholder="村组">
                    </div>
                </div>
                <div class="form-group">
                    <label for="identify_front" class="col-sm-2 control-label">身份证正面（带国徽的一面）：</label>
                    <div class="col-sm-10">
                        <input type="file" name="identify_front" id="identify_front" onchange="saveFile(this)">
                    </div>
                    <div class="col-sm-10">
                        <input type="button" value="下载文件" name="downloadFile" id="downloadFile">
                    </div>
                </div>
                <div class="form-group">
                    <label for="identify_back" class="col-sm-2 control-label">身份证反面（个人信息的一面）：</label>
                    <div class="col-sm-10">
                        <input type="file" name="identify_back" id="identify_back" onchange="saveFile(this)">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" id="submit" class="btn btn-default">保存</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!--底部导航条-->
<footer class="am-menu am-cf">
    <div class="am-menu-column" id="index">
        <a href="/poverty">
            <span>首页</span>
        </a>
    </div>
    <div class="am-menu-column" id="explore">
        <a href="/poverty/apply">
            <span>申请</span>
        </a>
    </div>
    <div class="am-menu-column" id="life">
        <a href="/poverty/information">
            <span>记录</span>
        </a>
    </div>
    <div class="am-menu-column active" id="my">
        <a href="/poverty/user">
            <span>我的</span>
        </a>
    </div>
</footer>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script th:src="@{../static/js/jquery.min.js}"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script th:src="@{../static/js/bootstrap.min.js}"></script>
<script>
    var front_path = null;
    var back_path = null;
    function saveFile(obj){
        var data = new FormData();
        data.append('file', obj.files[0]);
        if(front_path != null && obj.id == 'identify_front'){
            data.append('frontPath',front_path);
        }
        if(back_path != null && obj.id == 'identify_back'){
            data.append('backPath',back_path);
        }
        //判断类型
        var filename = obj.value;
        extStart = filename.lastIndexOf('.');
        ext = obj.value.substring(extStart,filename.length).toUpperCase();
        data.append('type',ext);
        $.ajax({
        url: '/poverty/upload',
        type: 'POST',
        data: data,
        cache: false,
        processData: false,
        contentType: false,
        success:function(result){
                alert("上传成功！");
                if(obj.id == 'identify_front'){
                    front_path=result;
                }else {
                    back_path=result;
                }
            },
        error:function(result){
                alert("上传失败！");
            }
        });
    }

    $("#downloadFile").click(function(){
        window.location.href="http://127.0.0.1:8083/poverty/download?path="+front_path;
    });



    $("#submit").click(function(){
        $.post('/poverty/userMsg',
        {
            'name':$('#name').val(),
            'identity':$('#identity').val(),
            'tel':$('#tel').val(),
            'village':$('#village').val(),
            'identify_front':front_path,
            'identify_back':back_path
        },
        function(data,status){
            alert("数据: \n" + data + "\n状态: " + status);
        });

    });
</script>
</body>
</html>